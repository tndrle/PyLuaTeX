%% Copyright 2021-2022 Tobias Enderle
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3c
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.

\documentclass{article}

\usepackage{pyluatex}

\begin{document}

\ifdefined\TestAll

% simple tests
\py{1 + 3}

\pyc{x = 1}
\py{x}

% environment
\begin{python}
a = 1
assert a == 1
\end{python}

% environment with indentation
\begin{python}
    a = 1
    assert a == 1
\end{python}

% verbatim
\begin{python}
    a = 5 % 3
    assert a == 2
    _b = 1
    c = '\n'
\end{python}

% sessions
\pyc{sessionTest = 1}
\pysession{a}
\pyc{sessionTest = 2}
\pyc{assert sessionTest == 2}
\pysession{default}
\pyc{assert sessionTest == 1}

% code on last line
\begin{python}
code_on_last_line = 1\end{python}\pyc{code_on_last_line2 = 2}
\pyc{assert code_on_last_line == 1}
\pyc{assert code_on_last_line2 == 2}

% multiline possible (only special cases, though)
\pyc{a = 
2}

% external Python file
\pyfile{test-cases/external.py}
\pyc{assert external_var == 11}
\pyc{del external_var}
\pyfile{\py{'test-cases/external.py'}}
\pyc{assert external_var == 11}

% nested calls
% 1. python environment is executed and prints '\py{_a}'
% 2. \py{_a} is executed and prints '9'
% note: If '\py{_a}' would be the final text the compilation would fail due to the underscore,
%       hence, successful compilation implies that nested execution works.
\begin{python}
_a = 9
print(r'\py{_a}')
\end{python}

% nested calls 2
\py{\py{\py{_a}}}

% empty code
\py{}
\py{ }
\pyc{}
\pyc{ }
\begin{python}
\end{python}
\begin{python}

\end{python}

% derived environments
\newenvironment{derivedenvA}
{\PyLTVerbatimEnv Before \begin{python}}{\end{python} After}

\begin{derivedenvA}
_a = 1
print(_a)
\end{derivedenvA}

\newenvironment{derivedenvB}
{\PyLTVerbatimEnv Before \begin{derivedenvA}}{\end{derivedenvA} After}

\begin{derivedenvB}
_a = 1
print(_a)
\end{derivedenvB}

% ignoreerrors option
\pyoption{ignoreerrors}{true}
\pyc{1 / 0}
\pyoption{ignoreerrors}{false}

\fi

\end{document}
